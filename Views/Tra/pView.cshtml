@using Admin.Models.Tra
@model Tra

@{
    Layout = "~/Views/Shared/PanelPortal.cshtml";
}

@section PageLevelPlugin {
    <link rel="stylesheet" href="~/admin/vendor/chosen_v1.4.0/chosen.min.css">
    <link rel="stylesheet" href="~/admin/vendor/jquery.tagsinput/jquery.tagsinput.css">
    <link rel="stylesheet" href="~/admin/vendor/checkbo/src/0.1.4/css/checkBo.min.css">
    <link rel="stylesheet" href="~/admin/vendor/intl-tel-input/build/css/intlTelInput.css">
    <link rel="stylesheet" href="~/admin/vendor/dropzone/dist/min/basic.min.css">
    <link rel="stylesheet" href="~/admin/vendor/dropzone/dist/min/dropzone.min.css">
    <link rel="stylesheet" href="~/admin/vendor/bootstrap-daterangepicker/daterangepicker-bs3.css">
    <link rel="stylesheet" href="~/admin/vendor/bootstrap-datepicker/dist/css/bootstrap-datepicker3.css">
    <link rel="stylesheet" href="~/admin/vendor/bootstrap-timepicker/css/bootstrap-timepicker.min.css">
    <link rel="stylesheet" href="~/admin/vendor/clockpicker/dist/bootstrap-clockpicker.min.css">
    <link rel="stylesheet" href="~/admin/vendor/mjolnic-bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css">
    <link rel="stylesheet" href="~/admin/vendor/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css">
    <style>
        table {
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid grey;
            text-align: center;
            padding: 2px;
        }

        .vertical-text {
            transform: rotate(270deg);
            transform-origin: left top 10px;
            float: left;
        }

        .red {
            color: white;
            background-color: red;
        }

        .yellow {
            background-color: yellow;
        }

        .green {
            color: white;
            background-color: green;
        }

        .darkblue {
            color: white;
            background-color: darkblue;
        }

        .purple {
            color: white;
            background-color: purple;
        }
    </style>
}

<!-- main area -->
<div class="main-content">
    <div class="panel mb25">
        <div class="panel-heading border">
            <strong>JSA AND Risk Assessment</strong>
        </div>
        <div class="panel-body">
            <div class="row no-margin">
                <div class="col-lg-12">
                    <form class="form-horizontal bordered-group" role="form" method="post" enctype="multipart/form-data" asp-action="Edit">
                        <div class="form-group">
                            <label asp-for="TraID" class="col-sm-2 control-label">ID</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="TraID" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="Company" class="col-sm-2 control-label">Perusahaan</label>
                            <div class="col-sm-10">
                                <input asp-for="Company" type="hidden" class="form-control">
                                <input readonly type="text" class="form-control" value="@ViewBag.VendorName">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="Project" class="col-sm-2 control-label">Project</label>
                            <div class="col-sm-10">
                                <input readonly type="text" class="form-control" value="@ViewBag.ProjectName">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="PenanggungJawab" class="col-sm-2 control-label">Penanggung Jawab</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="PenanggungJawab" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="Posisi" class="col-sm-2 control-label">Posisi</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="Posisi" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="Date" class="col-sm-2 control-label">Date</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="Date" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="DocNo" class="col-sm-2 control-label">Document No.</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="DocNo" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="TeamLeader" class="col-sm-2 control-label">Disiapkan Oleh (Team Leader)</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="TeamLeader" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="SponsorPekerjaan" class="col-sm-2 control-label">Direview Oleh (Sponsor Pekerjaan)</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="SponsorPekerjaan" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="HSSE" class="col-sm-2 control-label">Direview Oleh (HSSE)</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="HSSE" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="PimpinanPemilikWilayah" class="col-sm-2 control-label">Disetujui Oleh (Pemilik Wilayah)</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="PimpinanPemilikWilayah" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Status</label>
                            <div class="col-sm-10">
                                <input readonly type="text" value="@ViewBag.Status" class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div>
                <table style="width:50%;" class="table table-bordered bordered table-striped table-condensed datatable">
                    <thead>
                        <tr>
                            <td colspan="3" class="darkblue">Daftar Pekerja </td>
                        </tr>
                        <tr>
                            <td width="10%">No</td>
                            <td>Nama</td>
                        </tr>
                    </thead>
                    <tbody>
                        @{ int no = 1; }
                        @foreach (var item in ViewBag.Workers)
                        {
                            <tr>
                                <td>@no</td>
                                <td style="text-align:left">@item.WorkerName</td>
                            </tr>
                            no++;
                        }
                    </tbody>
                </table>
            </div>
            <table class="table table-bordered bordered table-striped table-condensed datatable">
                <thead>
                    <tr>
                        <td colspan="11" class="darkblue">Daftar Aktifitas Kegiatan</td>
                    </tr>
                    <tr >
                        <th style="vertical-align:middle;">No</th>
                        <th style="vertical-align:middle;">Sequence Of Basic Job Steps</th>
                        <th style="vertical-align:middle;">Hazard</th>
                        <th style="vertical-align:middle;">Consequence</th>
                        <th style="vertical-align:middle;">I.Risk</th>
                        <th style="vertical-align:middle;">Recommended Action</th>
                        <th style="vertical-align:middle;">Role Responsibility</th>
                        <th style="vertical-align:middle;">R.Risk</th>
                        <th style="vertical-align:middle;">ALARP</th>
                        <th style="vertical-align:middle;">AC</th>
                    </tr>
                </thead>
                <tbody>
                    @{ no = 1; }
                    @foreach (var item in ViewBag.ProjectTasks)
                    {
                        <tr>
                            <td>@no</td>
                            <td style="text-align:left">@item.SequenceOfBasicJobSteps</td>
                            <td style="text-align:left">@item.Hazard</td>
                            <td style="text-align:left">@item.Consequence</td>
                            <td style="text-align:left">@item.InitialRisk</td>
                            <td style="text-align:left">@item.RecommendedAction</td>
                            <td style="text-align:left">@item.RoleResponsibility</td>
                            <td style="text-align:left">@item.ResidualRisk</td>
                            <td style="text-align:left">@item.ALARP</td>
                            <td style="text-align:left">@item.AC</td>
                        </tr>
                        no++;
                    }
                </tbody>
            </table>
            <div>
                <a asp-controller="TRA" asp-action="pIndex" class="btn btn-sm btn-round btn-danger"><i class="fa fa-arrow-left"></i> Back</a>
            </div>
        </div>
    </div>
</div>
<!-- /main area -->

@section PageLevelScripts {
    <script src="~/admin/vendor/chosen_v1.4.0/chosen.jquery.min.js"></script>
    <script src="~/admin/vendor/jquery.tagsinput/jquery.tagsinput.min.js"></script>
    <script src="~/admin/vendor/checkbo/src/0.1.4/js/checkBo.min.js"></script>
    <script src="~/admin/vendor/intl-tel-input//build/js/intlTelInput.min.js"></script>
    <script src="~/admin/vendor/dropzone/dist/min/dropzone.min.js"></script>
    <script src="~/admin/vendor/moment/min/moment.min.js"></script>
    <script src="~/admin/vendor/bootstrap-daterangepicker/daterangepicker.js"></script>
    <script src="~/admin/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
    <script src="~/admin/vendor/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
    <script src="~/admin/vendor/clockpicker/dist/jquery-clockpicker.min.js"></script>
    <script src="~/admin/vendor/mjolnic-bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js"></script>
    <script src="~/admin/vendor/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>
    <script>
        $('#InitialRisk').on('click', function () {
            $('#caller').val('InitialRisk');
                    });

        $('#ResidualRisk').on('click', function () {
            $('#caller').val('ResidualRisk');
                    });

        $('.EditWorker').on('click', function () {
                        var token = $('input[name="__RequestVerificationToken"]').val();
                        var myData = { WorkerID: $(this).data('id') };
            var dataWithAntiforgeryToken = $.extend(myData, { '__RequestVerificationToken': token });
            $.ajax({
                url: "/TRA/GetWorker",
                type: "POST",
                data: dataWithAntiforgeryToken,
                success: function (data) {
                    $('#WorkerID').val(data.workerID);
                    $('#WorkerName').val(data.workerName);
                },
                error: function () {
                }
            });
        });

        $('.EditTask').on('click', function () {
            var token = $('input[name="__RequestVerificationToken"]').val();
            var myData = { ProjectTaskID: $(this).data('id') };
            var dataWithAntiforgeryToken = $.extend(myData, { '__RequestVerificationToken': token });
            $.ajax({
                url: "/TRA/GetProjectTask",
                type: "POST",
                data: dataWithAntiforgeryToken,
                success: function (data) {
                    $('#ProjectTaskID').val(data.projectTaskID);
                    $('#SequenceOfBasicJobSteps').val(data.sequenceOfBasicJobSteps);
                    $('#Hazard').val(data.hazard);
                    $('#Consequence').val(data.consequence);
                    $('#InitialRisk').val(data.initialRisk);
                    $('#RecommendedAction').val(data.recommendedAction);
                    $('#RoleResponsibility').val(data.roleResponsibility);
                    $('#ResidualRisk').val(data.residualRisk);
                    if (data.alarp == 'Y')
                        $('#ALARPY').prop('checked',true);
                    else if (data.alarp == 'N')
                        $('#ALARPN').attr('checked',true);

                    if (data.ac == 'Y')
                        $('#ACY').prop('checked', true);
                    else if (data.ac == 'N')
                        $('#ACN').attr('checked', true);

                },
                error: function () {
                }
            });
        });

        function SelectRiskMatrix(selected) {
            if ($('#caller').val() == 'InitialRisk') {
                $('#InitialRisk').val(selected);
                $('#ModalRiskMatrix').modal('hide');
            }
            else if ($('#caller').val() == 'ResidualRisk') {
                $('#ResidualRisk').val(selected);
                $('#ModalRiskMatrix').modal('hide');
            }
        }
    </script>
}

@section InitPageScripts {
    <script src="~/admin/scripts/pages/form-custom.js"></script>
}
