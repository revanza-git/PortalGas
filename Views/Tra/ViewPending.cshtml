@model Tra

@{
    Layout = "~/Views/Shared/Panel.cshtml";
}

@section TitleBar {
    <strong>JSA AND Risk Assessment</strong>
}

@section PageLevelPlugin {
    <link rel="stylesheet" href="~/admin/vendor/chosen_v1.4.0/chosen.min.css">
    <link rel="stylesheet" href="~/admin/vendor/jquery.tagsinput/jquery.tagsinput.css">
    <link rel="stylesheet" href="~/admin/vendor/checkbo/src/0.1.4/css/checkBo.min.css">
    <link rel="stylesheet" href="~/admin/vendor/intl-tel-input/build/css/intlTelInput.css">
    <link rel="stylesheet" href="~/admin/vendor/dropzone/dist/min/basic.min.css">
    <link rel="stylesheet" href="~/admin/vendor/dropzone/dist/min/dropzone.min.css">
    <link rel="stylesheet" href="~/admin/vendor/bootstrap-daterangepicker/daterangepicker-bs3.css">
    <link rel="stylesheet" href="~/admin/vendor/bootstrap-datepicker/dist/css/bootstrap-datepicker3.css">
    <link rel="stylesheet" href="~/admin/vendor/bootstrap-timepicker/css/bootstrap-timepicker.min.css">
    <link rel="stylesheet" href="~/admin/vendor/clockpicker/dist/bootstrap-clockpicker.min.css">
    <link rel="stylesheet" href="~/admin/vendor/mjolnic-bootstrap-colorpicker/dist/css/bootstrap-colorpicker.min.css">
    <link rel="stylesheet" href="~/admin/vendor/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.css">
    <style>
        table {
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid grey;
            text-align: center;
            padding: 2px;
        }

        .vertical-text {
            transform: rotate(270deg);
            transform-origin: left top 10;
            float: left;
        }

        .red {
            color: white;
            background-color: red;
        }

        .yellow {
            background-color: yellow;
        }

        .green {
            color: white;
            background-color: green;
        }

        .darkblue {
            color: white;
            background-color: darkblue;
        }

        .purple {
            color: white;
            background-color: purple;
        }
    </style>
}

<!-- main area -->
<div class="main-content">
    <div class="panel mb25">
        <div class="panel-heading border">
            <ol class="breadcrumb mb0 no-padding">
                <li>
                    <a href="javascript:;">Content</a>
                </li>
                <li>
                    <a href="javascript:;">JSA and Risk Assessment</a>
                </li>
                <li class="active"><strong>@ViewBag.Title</strong></li>
            </ol>
        </div>
        <div class="panel-body">
            @if (TempData["message"] != null)
            {
                <div class="alert alert-success"><i class="fa fa-lg fa-check-circle"></i> @TempData["message"]</div>
            }
            <div class="row no-margin">
                <div class="col-lg-12">
                    <form class="form-horizontal bordered-group" role="form" method="post" enctype="multipart/form-data" asp-action="Edit">
                        <div class="form-group">
                            <label asp-for="TraID" class="col-sm-2 control-label">ID</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="TraID" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="Company" class="col-sm-2 control-label">Perusahaan</label>
                            <div class="col-sm-10">
                                <input asp-for="Company" type="hidden" class="form-control">
                                <input readonly type="text" class="form-control" value="@ViewBag.VendorName">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="Project" class="col-sm-2 control-label">Project</label>
                            <div class="col-sm-10">
                                <input readonly type="text" class="form-control" value="@ViewBag.ProjectName">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="PenanggungJawab" class="col-sm-2 control-label">Penanggung Jawab</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="PenanggungJawab" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="Posisi" class="col-sm-2 control-label">Posisi</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="Posisi" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="Date" class="col-sm-2 control-label">Date</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="Date" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="DocNo" class="col-sm-2 control-label">Document No.</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="DocNo" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="TeamLeader" class="col-sm-2 control-label">Disiapkan Oleh (Team Leader)</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="TeamLeader" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="SponsorPekerjaan" class="col-sm-2 control-label">Direview Oleh (Sponsor Pekerjaan)</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="SponsorPekerjaan" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="HSSE" class="col-sm-2 control-label">Direview Oleh (HSSE)</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="HSSE" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label asp-for="PimpinanPemilikWilayah" class="col-sm-2 control-label">Disetujui Oleh (Pemilik Wilayah)</label>
                            <div class="col-sm-10">
                                <input readonly asp-for="PimpinanPemilikWilayah" type="text" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">Status</label>
                            <div class="col-sm-10">
                                <input readonly type="text" value="@ViewBag.Status" class="form-control">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div>
                <table style="width:50%;" class="table table-bordered bordered table-striped table-condensed datatable">
                    <thead>
                        <tr>
                            <td colspan="3" class="darkblue">Daftar Pekerja </td>
                        </tr>
                        <tr>
                            <td width="10%">No</td>
                            <td>Nama</td>
                            <td width="20%">Action</td>
                        </tr>
                    </thead>
                    <tbody>
                        @{ int no = 1; }
                        @foreach (var item in ViewBag.Workers)
                        {
                            <tr>
                                <td>@no</td>
                                <td style="text-align:left">@item.WorkerName</td>
                                <td>
                                </td>
                            </tr>
                            no++;
                        }
                    </tbody>
                </table>
            </div>
            <table class="table table-bordered bordered table-striped table-condensed datatable">
                <thead>
                    <tr>
                        <td colspan="11" class="darkblue">Daftar Aktifitas Kegiatan</td>
                    </tr>
                    <tr >
                        <th style="vertical-align:middle;">No</th>
                        <th style="vertical-align:middle;">Sequence Of Basic Job Steps</th>
                        <th style="vertical-align:middle;">Hazard</th>
                        <th style="vertical-align:middle;">Consequence</th>
                        <th style="vertical-align:middle;">I.Risk</th>
                        <th style="vertical-align:middle;">Recommended Action</th>
                        <th style="vertical-align:middle;">Role Responsibility</th>
                        <th style="vertical-align:middle;">R.Risk</th>
                        <th style="vertical-align:middle;">ALARP</th>
                        <th style="vertical-align:middle;">AC</th>
                        <th style="vertical-align:middle;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    @{ no = 1; }
                    @foreach (var item in ViewBag.ProjectTasks)
                    {
                        <tr>
                            <td>@no</td>
                            <td style="text-align:left">@item.SequenceOfBasicJobSteps</td>
                            <td style="text-align:left">@item.Hazard</td>
                            <td style="text-align:left">@item.Consequence</td>
                            <td style="text-align:left">@item.InitialRisk</td>
                            <td style="text-align:left">@item.RecommendedAction</td>
                            <td style="text-align:left">@item.RoleResponsibility</td>
                            <td style="text-align:left">@item.ResidualRisk</td>
                            <td style="text-align:left">@item.ALARP</td>
                            <td style="text-align:left">@item.AC</td>
                            <td>
                            </td>
                        </tr>
                        no++;
                    }
                </tbody>
            </table>

            <form class="form-horizontal bordered-group" role="form" method="post" asp-action="Approve">
                <input type="hidden" name="TraID" value="@Model.TraID" />
                @switch (Model.Status)
                {
                    case 1:
                        <button type="submit" name="Action" value="SubmitVendor" onclick="return confirm('Are you sure you want to submit this data?');" class="btn btn-success btn-round btn-sm"><i class="fa fa-check"></i> Submit</button>
                        break;
                }
                <a asp-controller="TRA" asp-action="Pending" class="btn btn-sm btn-round btn-danger"><i class="fa fa-arrow-left"></i> Back</a>
            </form>
        </div>
    </div>
</div>
<!-- /main area -->
<!-- Modal Area-->
<div id="ModalAddTask" class="modal fade" role="dialog">
    <div class="modal-dialog" style="overflow-y:auto;height:90%;">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h5 class="modal-title"><i class="fa fa-calendar fa-lg"></i>  Add Project Activity</h5>
            </div>
            <form class="form-horizontal bordered-group" role="form" method="post" asp-action="EditTask">
                <input type="hidden" id="ProjectTaskID" name="ProjectTaskID" value="0" />
                <div class="modal-body">
                    <div class="form-group">
                        <label asp-for="TraID" class="col-sm-4 control-label">TraID</label>
                        <div class="col-sm-6">
                            <input readonly asp-for="TraID" type="text" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Sequence Of Basic Job Steps</label>
`                        <div class="col-sm-6">
                            <input name="SequenceOfBasicJobSteps" id="SequenceOfBasicJobSteps" type="text" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Hazard</label>
                        <div class="col-sm-6">
                            <input name="Hazard" id="Hazard" type="text" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Consequence</label>
                        <div class="col-sm-6">
                            <input name="Consequence" id="Consequence" type="text" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Initial Risk</label>
                        <div class="col-sm-6">
                            <input readonly data-toggle="modal" data-target="#ModalRiskMatrix" name="InitialRisk" id="InitialRisk" type="text" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Recommended Action</label>
                        <div class="col-sm-6">
                            <input name="RecommendedAction" id="RecommendedAction" type="text" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Role Responsibility</label>
                        <div class="col-sm-6">
                            <input name="RoleResponsibility" id="RoleResponsibility" type="text" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Residual Risk</label>
                        <div class="col-sm-6">
                            <input readonly data-toggle="modal" data-target="#ModalRiskMatrix" name="ResidualRisk" id="ResidualRisk" type="text" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">ALARP</label>
                        <div class="col-sm-6">
                            <div class="radio">
                                <label><input name="ALARP" id="ALARPY" type="radio" value="Y"> Y</label>&nbsp;&nbsp;&nbsp;
                                <label><input name="ALARP" id="ALARPN" type="radio" value="N"> N</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">AC</label>
                        <div class="col-sm-6">
                            <div class="radio">
                                <label><input name="AC" id="ACY" type="radio" value="Y"> Y</label>&nbsp;&nbsp;&nbsp;
                                <label><input name="AC" id="ACN" type="radio" value="N"> N</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-round btn-success btn-sm"><i class="fa fa-save"></i> Save</button>
                    <button type="button" class="btn btn-round btn-danger btn-sm" data-dismiss="modal"><i class="fa fa-times"></i> CLose</button>
                </div>
            </form>
        </div>
    </div>
</div>
<div id="ModalAddWorker" class="modal fade" role="dialog">
    <div class="modal-dialog" style="overflow-y:auto;height:90%;">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h5 class="modal-title"><i class="fa fa-user fa-lg"></i>  Tambah/Edit Pekerja</h5>
            </div>
            <form class="form-horizontal bordered-group" role="form" method="post" asp-action="EditWorker">
                <input type="hidden" name="WorkerID" id="WorkerID" value="0" />
                <div class="modal-body">
                    <div class="form-group">
                        <label asp-for="TraID" class="col-sm-4 control-label">TraID</label>
                        <div class="col-sm-6">
                            <input readonly asp-for="TraID" type="text" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">Nama Pekerja</label>
                        <div class="col-sm-6">
                            <input name="WorkerName" id="WorkerName" type="text" class="form-control">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-round btn-success btn-sm"><i class="fa fa-save"></i> Save</button>
                    <button type="button" class="btn btn-round btn-danger btn-sm" data-dismiss="modal"><i class="fa fa-times"></i> CLose</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div id="ModalRiskMatrix" class="modal fade" role="dialog">
    <div class="modal-dialog" style="width:100%;">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h5 class="modal-title"><i class="fa fa-calendar fa-lg"></i>  Risk Matrix</h5>
            </div>
            <input type="hidden" id="caller" />
            <div class="modal-body">
                <table class="table1">
                    <tr>
                        <td rowspan="3"><span class='vertical-text'>TINGKAT</span></td>
                        <td colspan="5">PARAMETER AKIBAT</td>
                        <td colspan="5">PROBABILITAS</td>
                    </tr>
                    <tr>
                        <td rowspan="2">KESEHATAN & KESELAMATAN</td>
                        <td rowspan="2">KEAMANAN</td>
                        <td rowspan="2">LINGKUNGAN</td>
                        <td rowspan="2">ASET & PERALATAN</td>
                        <td rowspan="2">REPUTASI & HUKUM</td>
                        <td class="darkblue">1</td>
                        <td class="darkblue">2</td>
                        <td class="darkblue">3</td>
                        <td class="darkblue">4</td>
                        <td class="darkblue">5</td>
                    </tr>
                    <tr>
                        <td>Tidak pernah terdengar di industri/perkantoran migas</td>
                        <td>Pernah terdengar di industri/perkantoran migas</td>
                        <td>Pernah terjadi di industri/perkantoran migas</td>
                        <td>Terjadi beberapa kali di industri/perkantoran migas, atau pernah terjadi di kegiatan/operasi perusahaan sejenis</td>
                        <td>Terjadi beberapa kali di salah satu kegiatan/operasi perusahaan</td>
                    </tr>
                    <tr height="75px">
                        <td class="purple">1</td>
                        <td>Cidera/sakit ringan</td>
                        <td>Konsekuensi ringan</td>
                        <td>Dampak ringan</td>
                        <td>Kerusakan ringan</td>
                        <td>Dampak ringan</td>
                        <td class="green" onclick="SelectRiskMatrix('1 L')">1 L</td>
                        <td class="green" onclick="SelectRiskMatrix('2 L')">2 L</td>
                        <td class="green" onclick="SelectRiskMatrix('3 L')">3 L</td>
                        <td class="green" onclick="SelectRiskMatrix('4 L')">4 L</td>
                        <td class="yellow" onclick="SelectRiskMatrix('5 M')">5 M</td>
                    </tr>
                    <tr height="75px">
                        <td class="purple">2</td>
                        <td>Cidera/sakit sedang</td>
                        <td>Konsekuensi sedang</td>
                        <td>Dampak sedang</td>
                        <td>Kerusakan sedang</td>
                        <td>Dampak sedang</td>
                        <td class="green" onclick="SelectRiskMatrix('2 L')">2 L</td>
                        <td class="green" onclick="SelectRiskMatrix('4 L')">4 L</td>
                        <td class="yellow" onclick="SelectRiskMatrix('6 M')">6 M</td>
                        <td class="yellow" onclick="SelectRiskMatrix('8 M')">8 M</td>
                        <td class="yellow" onclick="SelectRiskMatrix('10 M')">10 M</td>
                    </tr>
                    <tr height="75px">
                        <td class="purple">3</td>
                        <td>Cidera/sakit berat</td>
                        <td>Konsekuensi berat</td>
                        <td>Dampak berat</td>
                        <td>Kerusakan berat</td>
                        <td>Dampak berat</td>
                        <td class="green" onclick="SelectRiskMatrix('3 L')">3 L</td>
                        <td class="yellow" onclick="SelectRiskMatrix('6 M')">6 M</td>
                        <td class="yellow" onclick="SelectRiskMatrix('9 M')">9 M</td>
                        <td class="yellow" onclick="SelectRiskMatrix('12 M')">12 M</td>
                        <td class="red" onclick="SelectRiskMatrix('15 H')">15 H</td>
                    </tr> 
                    <tr height="75px">
                        <td class="purple">4</td>
                        <td>Single Fatality/Cacat Permanen</td>
                        <td>Konsekuensi besar</td>
                        <td>Dampak besar berskala nasional</td>
                        <td>Kerusakan besar</td>
                        <td>Dampak besar berskala nasional</td>
                        <td class="green" onclick="SelectRiskMatrix('4 L')">4 L</td>
                        <td class="yellow" onclick="SelectRiskMatrix('8 M')">8 M</td>
                        <td class="yellow" onclick="SelectRiskMatrix('12 M')">12 M</td>
                        <td class="red" onclick="SelectRiskMatrix('16 H')">16 H</td>
                        <td class="red" onclick="SelectRiskMatrix('20 H')">20 H</td>
                    </tr>
                    <tr height="75px">
                        <td class="purple">5</td>
                        <td>Multiple Fatality/Fatality lebih dari 1</td>
                        <td>Konsekuensi parah</td>
                        <td>Dampak besar berskala internasional</td>
                        <td>Kerusakan parah</td>
                        <td>Dampak besar berskala internasional</td>
                        <td class="yellow" onclick="SelectRiskMatrix('5 M')">5 M</td>
                        <td class="yellow" onclick="SelectRiskMatrix('10 M')">10 M</td>
                        <td class="red" onclick="SelectRiskMatrix('15 H')">15 H</td>
                        <td class="red" onclick="SelectRiskMatrix('20 H')">20 H</td>
                        <td class="red" onclick="SelectRiskMatrix('25 H')">25 H</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- End Of Modal-->
@section PageLevelScripts {
    <script src="~/admin/vendor/chosen_v1.4.0/chosen.jquery.min.js"></script>
    <script src="~/admin/vendor/jquery.tagsinput/jquery.tagsinput.min.js"></script>
    <script src="~/admin/vendor/checkbo/src/0.1.4/js/checkBo.min.js"></script>
    <script src="~/admin/vendor/intl-tel-input//build/js/intlTelInput.min.js"></script>
    <script src="~/admin/vendor/dropzone/dist/min/dropzone.min.js"></script>
    <script src="~/admin/vendor/moment/min/moment.min.js"></script>
    <script src="~/admin/vendor/bootstrap-daterangepicker/daterangepicker.js"></script>
    <script src="~/admin/vendor/bootstrap-datepicker/js/bootstrap-datepicker.js"></script>
    <script src="~/admin/vendor/bootstrap-timepicker/js/bootstrap-timepicker.min.js"></script>
    <script src="~/admin/vendor/clockpicker/dist/jquery-clockpicker.min.js"></script>
    <script src="~/admin/vendor/mjolnic-bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js"></script>
    <script src="~/admin/vendor/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>
    <script>
        $('#InitialRisk').on('click', function () {
            $('#caller').val('InitialRisk');
                    });

        $('#ResidualRisk').on('click', function () {
            $('#caller').val('ResidualRisk');
                    });

        $('.EditWorker').on('click', function () {
                        var token = $('input[name="__RequestVerificationToken"]').val();
                        var myData = { WorkerID: $(this).data('id') };
            var dataWithAntiforgeryToken = $.extend(myData, { '__RequestVerificationToken': token });
            $.ajax({
                url: "/TRA/GetWorker",
                type: "POST",
                data: dataWithAntiforgeryToken,
                success: function (data) {
                    $('#WorkerID').val(data.workerID);
                    $('#WorkerName').val(data.workerName);
                },
                error: function () {
                }
            });
        });

        $('.EditTask').on('click', function () {
            var token = $('input[name="__RequestVerificationToken"]').val();
            var myData = { ProjectTaskID: $(this).data('id') };
            var dataWithAntiforgeryToken = $.extend(myData, { '__RequestVerificationToken': token });
            $.ajax({
                url: "/TRA/GetProjectTask",
                type: "POST",
                data: dataWithAntiforgeryToken,
                success: function (data) {
                    $('#ProjectTaskID').val(data.projectTaskID);
                    $('#SequenceOfBasicJobSteps').val(data.sequenceOfBasicJobSteps);
                    $('#Hazard').val(data.hazard);
                    $('#Consequence').val(data.consequence);
                    $('#InitialRisk').val(data.initialRisk);
                    $('#RecommendedAction').val(data.recommendedAction);
                    $('#RoleResponsibility').val(data.roleResponsibility);
                    $('#ResidualRisk').val(data.residualRisk);
                    if (data.alarp == 'Y')
                        $('#ALARPY').prop('checked',true);
                    else if (data.alarp == 'N')
                        $('#ALARPN').attr('checked',true);

                    if (data.ac == 'Y')
                        $('#ACY').prop('checked', true);
                    else if (data.ac == 'N')
                        $('#ACN').attr('checked', true);

                },
                error: function () {
                }
            });
        });

        function SelectRiskMatrix(selected) {
            if ($('#caller').val() == 'InitialRisk') {
                $('#InitialRisk').val(selected);
                $('#ModalRiskMatrix').modal('hide');
            }
            else if ($('#caller').val() == 'ResidualRisk') {
                $('#ResidualRisk').val(selected);
                $('#ModalRiskMatrix').modal('hide');
            }
        }
    </script>
}

@section InitPageScripts {
    <script src="~/admin/scripts/pages/form-custom.js"></script>
}
